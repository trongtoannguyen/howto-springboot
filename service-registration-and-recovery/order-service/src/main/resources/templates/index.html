<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPhone Store</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f7;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        /* Balance (Top Left) */
        .balance {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .balance-label {
            font-size: 14px;
            color: #666;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: bold;
            color: #1d1d1f;
        }


        /* Account Info (Top Right) */
        .account-info {
            text-align: right;
        }

        .new-wallet-info {
            text-align: center;
        }

        .account-name {
            font-size: 16px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .account-email {
            font-size: 13px;
            color: #86868b;
        }

        /* Main Content */
        .main-content {
            flex: 1;
        }

        /* Order Form (Center) */
        .order-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .order-title {
            font-size: 28px;
            font-weight: 700;
            color: #1d1d1f;
            text-align: center;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #1d1d1f;
            margin-bottom: 8px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 15px;
            transition: border 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #0071e3;
        }

        .btn-order {
            width: 100%;
            padding: 15px;
            background: #0071e3;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-order:hover {
            background: #0077ed;
        }

        .btn {
            padding: 10px 15px;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #02386d;
        }

        .btn-primary {
            background: #0071e3;
            color: white;
            border: none;
        }

        .product-info {
            background: #f5f5f7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .product-name {
            font-size: 20px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .product-price {
            font-size: 24px;
            font-weight: 700;
            color: #0071e3;
            margin-top: 5px;
        }

        /* Footer */
        .footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            color: #86868b;
            font-size: 13px;
        }

        .footer a {
            color: #0071e3;
            text-decoration: none;
            font-weight: 500;
        }

        .footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
<!-- Header with Balance and Account Info -->
<div class="header">
    <!-- Balance (Top Left) -->
    <div class="balance">
        <div th:if="${balance}">
            <div class="balance-label">Your Balance</div>
            <div class="balance-amount" th:text="${'$' + balance}">$0,000</div>
        </div>
        <div class="fund-new" th:unless="${balance}">
            <form action="/fund" method="get">
                <button type="submit" class="btn btn-primary">Fund New Wallet</button>
            </form>
        </div>
    </div>

    <div class="new-wallet-info">
        <div th:if="${walletInfo}" th:text="${walletInfo}">Fund to get new wallet</div>
        <a th:unless="${walletInfo}" href="/">Home</a>
    </div>

    <!-- Account Info (Top Right) -->
    <div class="account-info">
        <div class="total-wallets">
            Total Wallets: <p class="balance-label" th:text="${walletCount}">0</p>
        </div>
        <form action="/balance" method="get">
            <label>
                <input type="number" name="walletNumber" placeholder="Enter wallet number" required>
            </label>
            <button type="submit" class="btn btn-primary">Check Balance</button>
        </form>
    </div>
</div>

<!-- Main Content -->
<div class="main-content">
    <!-- Order Form (Center) -->
    <div class="order-container">
        <h1 class="order-title">Order New iPhone</h1>

        <!--        <div class="product-info">-->
        <!--            <div class="product-name" th:text="${prodName ?: 'Choose one'}"></div>-->
        <!--            <div class="product-price" th:text="${prodPrice ?: '$0.00'}"></div>-->
        <!--        </div>-->

        <form id="order-form" th:action="@{/order}" method="post">
            <!-- Product Selection -->
            <div class="form-group">
                <label for="productSelected">Select Product:</label>
                <select id="productSelected" name="productSelected" required>
                    <option value="" disabled selected>-- Choose a product --</option>
                    <option th:each="product : ${products}"
                            th:value="${product}"
                            th:text="${product.id + ' - ' + product.name + ' - $' + product.price}"
                            th:attr="data-id=${product.id}, data-price=${product.price}">
                    </option>
                </select>
            </div>

            <!-- Quantity -->
            <div class="form-group">
                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" name="quantity" value="1" min="1" max="100" required/>
            </div>

            <!-- Total Price Display -->
            <div class="form-group">
                <div class="price-display" id="totalPrice">Total: $0.00</div>
            </div>

            <!-- Card Holder -->
            <div class="form-group">
                <label for="walletNumber">Wallet Number:</label>
                <input type="text" id="walletNumber" name="walletNumber"
                       placeholder="Enter e-wallet number" required/>
            </div>

            <!-- CVV -->
            <div class="form-group">
                <label for="cvv">CVV:</label>
                <input type="text" id="cvv" name="cvv"
                       placeholder="123" maxlength="4" required/>
            </div>

            <button type="submit" class="btn btn-primary btn-order">Place Order</button>
        </form>
    </div>
</div>

<!-- Footer -->
<div class="footer">
    with support of <a href="https://claude.ai" target="_blank">Claude</a> in UI building
</div>
<script>
    // calculate total price
    const selectedProductElement = document.getElementById('productSelected');
    const totalPriceDiv = document.getElementById('totalPrice');
    const quantityElement = document.getElementById('quantity');
    const orderForm = document.getElementById('order-form');
    let selectedProductId;
    let price;
    let quantity;
    let total;
    let walletNumber;
    let cvv;

    function setVariableOnchange() {
        if (selectedProductElement.selectedIndex > 0) {
            selectedProductId = selectedProductElement.options[selectedProductElement.selectedIndex].getAttribute('data-id');
            price = selectedProductElement.options[selectedProductElement.selectedIndex].getAttribute('data-price');
            quantity = quantityElement.value;
            walletNumber = document.getElementById('walletNumber').value;
            cvv = document.getElementById('cvv').value;
            return true;
        }
        return false;
    }

    function calTotalPrice() {
        if (setVariableOnchange()) {
            total = (price * quantity).toFixed(3);
            totalPriceDiv.innerHTML = 'Total: $' + total;
        }
    }


    document.getElementById('order-form').onsubmit = function (e) {
        e.preventDefault();
        if (!setVariableOnchange()) {
            console.error('No product selected');
            return;
        }

        const payload = {
            productId: selectedProductId,
            quantity: quantity,
            walletNumber: walletNumber,
            cvv: cvv
        };

        console.log('Payload:', payload);

        fetch('/order', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Purchasing failed with status: ' + response.status);
                }
                return response.text();
            })
            .then(data => {
                console.log('Success:', data);
                alert(data);
                window.setTimeout(
                    function () {
                        window.location.reload();
                    }, 500
                )
            })
            .catch(
                error => {
                    console.error('Error:', error);
                    alert('Error placing order: ' + error.message);
                }
            );
    }

    orderForm.addEventListener('change', calTotalPrice);
</script>
</body>
</html>